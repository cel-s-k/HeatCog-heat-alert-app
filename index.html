<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat Monitoring Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">

import React, { useState, useEffect } from 'react';
import { Search, AlertCircle, Calendar, Thermometer } from 'lucide-react';

const CITIES = [
  { name: "Doha", lat: 25.2854, lon: 51.5310 },
  { name: "Accra", lat: 5.6037, lon: -0.1870 },
  { name: "Ibadan", lat: 7.3775, lon: 3.9470 },
  { name: "Nairobi", lat: -1.2864, lon: 36.8172 },
  { name: "Cairo", lat: 30.0444, lon: 31.2357 },
  { name: "Tunis", lat: 36.8065, lon: 10.1815 },
  { name: "Johannesburg", lat: -26.2041, lon: 28.0473 },
  { name: "New York", lat: 40.7128, lon: -74.0060 },
  { name: "Washington", lat: 38.9072, lon: -77.0369 },
  { name: "Los Angeles", lat: 34.0522, lon: -118.2437 },
  { name: "Houston", lat: 29.7604, lon: -95.3698 },
  { name: "Montreal", lat: 45.5017, lon: -73.5673 },
  { name: "Barranquilla", lat: 10.9685, lon: -74.7813 },
  { name: "Mexico City", lat: 19.4326, lon: -99.1332 },
  { name: "Rio de Janeiro", lat: -22.9068, lon: -43.1729 },
  { name: "Santiago", lat: -33.4489, lon: -70.6693 },
  { name: "Santa Cruz", lat: -17.8146, lon: -63.1561 },
  { name: "Bangalore", lat: 12.9716, lon: 77.5946 },
  { name: "Bombay", lat: 19.0760, lon: 72.8777 },
  { name: "Delhi", lat: 28.7041, lon: 77.1025 },
  { name: "Beijing", lat: 39.9042, lon: 116.4074 },
  { name: "Shenzhen", lat: 22.5431, lon: 114.0579 },
  { name: "Dhaka", lat: 23.8103, lon: 90.4125 },
  { name: "Ho Chi Minh City", lat: 10.8231, lon: 106.6297 },
  { name: "Islamabad", lat: 33.6844, lon: 73.0479 },
  { name: "Brisbane", lat: -27.4698, lon: 153.0251 },
  { name: "Singapore", lat: 1.3521, lon: 103.8198 },
  { name: "Manila", lat: 14.5995, lon: 120.9842 },
  { name: "Dubai", lat: 25.2048, lon: 55.2708 },
  { name: "Riyadh", lat: 24.7136, lon: 46.6753 },
  { name: "Ankara", lat: 39.9334, lon: 32.8597 },
  { name: "Athens", lat: 37.9838, lon: 23.7275 },
  { name: "Berlin", lat: 52.5200, lon: 13.4050 },
  { name: "London", lat: 51.5074, lon: -0.1278 },
  { name: "Madrid", lat: 40.4168, lon: -3.7038 },
  { name: "Rome", lat: 41.9028, lon: 12.4964 },
  { name: "Oslo", lat: 59.9139, lon: 10.7522 },
  { name: "Vienna", lat: 48.2082, lon: 16.3738 },
  { name: "Warsaw", lat: 52.2297, lon: 21.0122 },
  { name: "Bucharest", lat: 44.4268, lon: 26.1025 },
  { name: "Skopje", lat: 41.9973, lon: 21.4280 },
  { name: "Sydney", lat: -33.8688, lon: 151.2093 }
];

const TEMP_CUTOFF = 32;

const HeatMonitorDashboard = () => {
  const [selectedCity, setSelectedCity] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [weatherData, setWeatherData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const filteredCities = CITIES.filter(city =>
    city.name.toLowerCase().includes(searchTerm.toLowerCase())
  );

  const fetchWeatherData = async (city) => {
    setLoading(true);
    setError(null);
    
    try {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&daily=temperature_2m_max&temperature_unit=celsius&timezone=auto&past_days=3&forecast_days=14`;
      
      console.log('Fetching from:', url);
      
      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
        },
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();
      console.log('Weather data received:', data);
      setWeatherData(data);
    } catch (err) {
      console.error('Fetch error:', err);
      setError(`${err.message}. The Open-Meteo API might be temporarily unavailable or blocked in this environment. Try hosting this on your own server.`);
    } finally {
      setLoading(false);
    }
  };

  const selectCity = (city) => {
    setSelectedCity(city);
    setSearchTerm('');
    fetchWeatherData(city);
  };

  const getTempColor = (temp) => {
    if (temp > TEMP_CUTOFF) return 'bg-red-500';
    if (temp >= 25) return 'bg-yellow-500';
    return 'bg-green-500';
  };

  const getTempBorderColor = (temp) => {
    if (temp > TEMP_CUTOFF) return 'border-red-500';
    if (temp >= 25) return 'border-yellow-500';
    return 'border-green-500';
  };

  const findDataCollectionWindows = () => {
    if (!weatherData) return [];

    const temps = weatherData.daily.temperature_2m_max;
    const dates = weatherData.daily.time;
    const windows = [];

    for (let i = 3; i < temps.length - 2; i++) {
      if (temps[i] > TEMP_CUTOFF && temps[i + 1] > TEMP_CUTOFF) {
        let windowStart = i + 2;
        let windowEnd = windowStart;
        
        while (windowEnd < temps.length && temps[windowEnd] > TEMP_CUTOFF) {
          windowEnd++;
        }
        
        if (windowEnd > windowStart) {
          windows.push({
            heatDays: [dates[i], dates[i + 1]],
            collectionStart: dates[windowStart],
            collectionEnd: dates[windowEnd - 1],
            collectionDays: windowEnd - windowStart
          });
          i = windowEnd - 1;
        }
      }
    }

    return windows;
  };

  const isDateInWindow = (dateStr) => {
    const windows = findDataCollectionWindows();
    return windows.some(w => {
      const date = new Date(dateStr);
      const start = new Date(w.collectionStart);
      const end = new Date(w.collectionEnd);
      return date >= start && date <= end;
    });
  };

  const formatDate = (dateStr) => {
    const date = new Date(dateStr);
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const dateOnly = new Date(date);
    dateOnly.setHours(0, 0, 0, 0);

    if (dateOnly.getTime() === today.getTime()) return 'Today';
    
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);
    if (dateOnly.getTime() === tomorrow.getTime()) return 'Tomorrow';

    const yesterday = new Date(today);
    yesterday.setDate(today.getDate() - 1);
    if (dateOnly.getTime() === yesterday.getTime()) return 'Yesterday';

    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', weekday: 'short' });
  };

  const windows = weatherData ? findDataCollectionWindows() : [];

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-orange-50 p-6">
      <div className="max-w-6xl mx-auto">
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <div className="flex items-center gap-3 mb-6">
            <Thermometer className="w-8 h-8 text-orange-600" />
            <h1 className="text-3xl font-bold text-gray-800">Heat Monitoring Dashboard</h1>
          </div>

          <div className="relative">
            <div className="flex items-center gap-2 border-2 border-gray-300 rounded-lg p-3 focus-within:border-blue-500 transition-colors">
              <Search className="w-5 h-5 text-gray-400" />
              <input
                type="text"
                placeholder="Search for a city..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="flex-1 outline-none text-lg"
              />
            </div>

            {searchTerm && (
              <div className="absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-lg shadow-lg max-h-64 overflow-y-auto z-10">
                {filteredCities.length > 0 ? (
                  filteredCities.map((city) => (
                    <button
                      key={city.name}
                      onClick={() => selectCity(city)}
                      className="w-full text-left px-4 py-3 hover:bg-blue-50 transition-colors border-b border-gray-100 last:border-b-0"
                    >
                      <span className="font-medium">{city.name}</span>
                    </button>
                  ))
                ) : (
                  <div className="px-4 py-3 text-gray-500">No cities found</div>
                )}
              </div>
            )}
          </div>

          {selectedCity && (
            <div className="mt-4 p-4 bg-blue-50 rounded-lg">
              <p className="text-lg">
                Monitoring: <span className="font-bold text-blue-700">{selectedCity.name}</span>
              </p>
              <p className="text-sm text-gray-600 mt-1">
                Temperature threshold: {TEMP_CUTOFF}Â°C
              </p>
            </div>
          )}
        </div>

        {loading && (
          <div className="bg-white rounded-lg shadow-lg p-12 text-center">
            <div className="animate-pulse">Loading weather data...</div>
          </div>
        )}

        {error && (
          <div className="bg-red-50 border-2 border-red-200 rounded-lg p-6 text-red-700">
            Error: {error}
          </div>
        )}

        {weatherData && !loading && (
          <>
            {windows.length > 0 && (
              <div className="bg-orange-50 border-2 border-orange-300 rounded-lg p-6 mb-6">
                <div className="flex items-start gap-3">
                  <AlertCircle className="w-6 h-6 text-orange-600 flex-shrink-0 mt-1" />
                  <div className="flex-1">
                    <h2 className="text-xl font-bold text-orange-900 mb-3">
                      Data Collection Windows Detected!
                    </h2>
                    {windows.map((window, idx) => (
                      <div key={idx} className="mb-4 last:mb-0 p-4 bg-white rounded-lg">
                        <p className="font-semibold text-gray-800 mb-2">
                          Window {idx + 1}:
                        </p>
                        <ul className="space-y-1 text-sm text-gray-700">
                          <li>
                            ðŸ”¥ Heat days: {new Date(window.heatDays[0]).toLocaleDateString()} - {new Date(window.heatDays[1]).toLocaleDateString()}
                          </li>
                          <li>
                            ðŸ“Š Collection period: {new Date(window.collectionStart).toLocaleDateString()} - {new Date(window.collectionEnd).toLocaleDateString()}
                          </li>
                          <li>
                            ðŸ“… Duration: {window.collectionDays} day{window.collectionDays > 1 ? 's' : ''}
                          </li>
                        </ul>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}

            <div className="bg-white rounded-lg shadow-lg p-6">
              <div className="flex items-center gap-2 mb-6">
                <Calendar className="w-6 h-6 text-gray-600" />
                <h2 className="text-2xl font-bold text-gray-800">
                  Temperature Forecast
                </h2>
              </div>

              <div className="mb-6 flex gap-6 text-sm">
                <div className="flex items-center gap-2">
                  <div className="w-4 h-4 bg-green-500 rounded"></div>
                  <span>Below 25Â°C</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="w-4 h-4 bg-yellow-500 rounded"></div>
                  <span>25-32Â°C</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="w-4 h-4 bg-red-500 rounded"></div>
                  <span>Above 32Â°C</span>
                </div>
              </div>

              <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
                {weatherData.daily.time.map((date, idx) => {
                  const temp = weatherData.daily.temperature_2m_max[idx];
                  const isHistorical = idx < 3;
                  const isCollection = isDateInWindow(date);

                  return (
                    <div
                      key={date}
                      className={`border-2 rounded-lg p-3 transition-all ${
                        getTempBorderColor(temp)
                      } ${isCollection ? 'ring-4 ring-orange-300 shadow-lg' : ''}`}
                    >
                      <div className="text-xs font-semibold text-gray-600 mb-1">
                        {formatDate(date)}
                      </div>
                      <div className="text-xs text-gray-500 mb-2">
                        {new Date(date).toLocaleDateString('en-US', { month: 'numeric', day: 'numeric' })}
                        {isHistorical && ' (Past)'}
                      </div>
                      <div className="flex items-center justify-center gap-2">
                        <div className={`w-3 h-3 rounded-full ${getTempColor(temp)}`}></div>
                        <div className="text-2xl font-bold">
                          {temp ? Math.round(temp) : '--'}Â°
                        </div>
                      </div>
                      {isCollection && (
                        <div className="mt-2 text-xs font-bold text-orange-600 text-center">
                          ðŸ“Š COLLECT
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          </>
        )}

        {!selectedCity && !loading && (
          <div className="bg-white rounded-lg shadow-lg p-12 text-center text-gray-500">
            <Thermometer className="w-16 h-16 mx-auto mb-4 text-gray-300" />
            <p className="text-xl">Select a city to view heat monitoring data</p>
          </div>
        )}
      </div>
    </div>
  );
};

export default HeatMonitorDashboard;

    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>